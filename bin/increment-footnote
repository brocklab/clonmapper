#!/usr/bin/env python3

import argparse
import re
from pathlib import Path

PROTOCOL_METHODS = Path.cwd() / "md" / "methods.md"

footnote_cap_regex = re.compile(r"\[\^(\d+)\]")


def increment(line, start, offset, matches):
    for match in matches[::-1]:
        if int(match) >= start:
            line = line.replace(f"[^{match}]", f"[^{str(int(match) + offset)}]")
    return line


def main():

    parser = argparse.ArgumentParser()
    parser.add_argument(
        "-s", "--start", help="starting number to increment footnotes", type=int
    )
    parser.add_argument(
        "-i",
        "--increment",
        help="step size to increment with (default: %(default)s)",
        default=1,
        type=int,
    )
    parser.add_argument(
        "--file", help="path to file (default: %(default)s)", default=PROTOCOL_METHODS
    )
    args = parser.parse_args()

    protocol = Path(args.file)
    outlines = []

    with protocol.open("r") as f:
        lines = f.read().splitlines()

    for line in lines:
        matches = footnote_cap_regex.findall(line)
        if matches:
            line = increment(line, args.start, args.increment, matches)
        outlines.append(line)

    with protocol.open("w") as f:
        f.write("\n".join(outlines))


if __name__ == "__main__":
    main()
