#!/usr/bin/env python3

import re
import sys
from pathlib import Path

PROTOCOL = Path.cwd() / "protocol.md"

footnote_cap_regex = re.compile(r"\[\^(\d+)\]")


def increment(line, start, offset, matches):
    for match in matches[::-1]:
        if int(match) >= start:
            line = line.replace(f"[^{match}]", f"[^{str(int(match) + offset)}]")
    return line


def main():

    start = int(sys.argv[1])
    try:
        offset = int(sys.argv[2])
    except IndexError:
        offset = 1

    outlines = []

    with PROTOCOL.open("r") as f:
        lines = f.read().splitlines()

    for line in lines:
        matches = footnote_cap_regex.findall(line)
        if matches:
            line = increment(line, start, offset, matches)
        outlines.append(line)

    with PROTOCOL.open("w") as f:
        f.write("\n".join(outlines))


if __name__ == "__main__":
    main()
